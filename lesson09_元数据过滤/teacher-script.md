# Lesson 09 教师讲稿：元数据过滤（可直接照读）

## 开场（3-5min）
- 今天的目标：在融合后的候选集上应用元数据过滤，提升结果质量与一致性。
- 今天的产物：一套端到端可运行的过滤示例、统一错误结构、已填写的提交模板。

## 术语与背景（5min）
- 元数据：描述文档的结构化字段（来源、类型、时间、标签、语言、发布状态等）。
- 过滤算子：`eq/in/contains/range/exists` 与布尔组合 `and/or`。
- 预过滤 vs 后过滤：索引/候选生成前后各自的适用场景与取舍。

## 方法讲解（25min）
1) 字段与模式（schema）统一：命名、类型、缺省策略。
2) DSL 结构与布尔组合：可读性与可扩展性；AND/OR 优先级与短路。
3) 稳健性：缺失字段、类型不匹配、空列表语义与错误返回统一。
4) 性能：高选择性字段优先过滤；尽量前置过滤减少后续排序开销。

## 演示脚本（40min 实操）
- 打开 `examples/metadata_filter_demo.py`：
  - 运行基础 DSL 并查看命中；
  - 改动 `contains` 为字符串目标 vs 列表目标，对比语义；
  - 注入错误：未知算子/错误类型，观察错误结构与提示；
  - 增加 `exists` 与 `views` 的 `range`，检查命中变化与性能影响（简单计时）。

## 互动提问（贯穿）
- `in` 与 `contains` 的适用差异？
- 日期范围与时区如何统一？
- 空列表在 `in` 中的语义应如何定义？

## 练习安排（10-15min）
- 学生在脚本中新增 2 条过滤条件并验证：
  - `exists`（如 `updated_at` 必须存在）；
  - `range`（如 `views >= 500`）。

## 总结与提交（5-10min）
- 再次核对检查清单与提交模板；强调不可虚构声明与一致性检查。
- 下一课将利用过滤后的候选集，继续排序优化与答案抽取。

## 话术备忘
- 统一错误结构是课堂验收的“硬指标”；演示至少包含 1 条错误路径。
- 若数据稀疏，强调“高选择性字段优先过滤”的策略价值。