# RAG系统实验任务说明

## 实验概述

本实验基于检索增强生成(RAG)技术，构建一个完整的文档问答系统。学生需要按照TODO占位符的指导，逐步实现系统的核心功能。

## 实验环境

- Python 3.8+
- FastAPI Web框架
- SQLite数据库
- Milvus向量数据库
- OpenAI/火山引擎API

## 实验任务

### 任务1：文档上传和处理 (lab01-task1)

**目标**：实现PDF文档的上传、解析和文本分块功能

**涉及文件**：
- `src/services/document_processor.py`

**主要功能**：
1. 文档上传验证和存储
2. PDF文档解析提取文本内容
3. 文本智能分块处理
4. 数据库记录创建和更新

**实现要点**：
- 支持PDF格式文档上传
- 实现文本分块算法，保持语义完整性
- 创建Document和Chunk数据库记录
- 处理文档处理过程中的异常情况

### 任务2：文档向量化 (lab01-task2)

**目标**：将文档文本转换为向量表示，支持语义搜索

**涉及文件**：
- `src/services/embedding_service.py`
- `src/services/vector_service.py`

**主要功能**：
1. 文本嵌入向量生成
2. 批量向量化处理
3. 向量存储到Milvus数据库
4. 向量相似度计算

**实现要点**：
- 支持本地模型和API两种嵌入方式
- 实现批量处理提高效率
- 处理文本长度限制和截断
- 向量数据持久化存储

### 任务3：语义搜索实现 (lab01-task3)

**目标**：基于向量相似度实现文档语义搜索

**涉及文件**：
- `src/api/routes/vectors.py`
- `src/services/vector_service.py`

**主要功能**：
1. 查询文本向量化
2. 向量相似度搜索
3. 搜索结果排序和过滤
4. 搜索结果格式化返回

**实现要点**：
- 实现高效的向量搜索算法
- 支持相似度阈值过滤
- 返回相关文档片段和元数据
- 处理搜索异常和边界情况

### 任务4：RAG问答系统 (lab01-task4)

**目标**：结合检索和生成技术实现智能问答

**涉及文件**：
- `src/services/qa_service.py`
- `src/api/routes/qa.py`

**主要功能**：
1. 问题理解和文档检索
2. 上下文构建和提示工程
3. LLM调用生成回答
4. 回答质量评估

**实现要点**：
- 实现检索增强的问答流程
- 构建有效的提示模板
- 处理LLM API调用和异常
- 提供回答来源和置信度

### 任务5：系统监控和健康检查 (lab01-task5)

**目标**：实现系统状态监控和健康检查功能

**涉及文件**：
- `src/api/routes/system.py`

**主要功能**：
1. 各组件健康状态检查
2. 系统统计信息收集
3. 性能指标监控
4. 异常状态报告

**实现要点**：
- 检查数据库、向量存储、API连接状态
- 收集文档、向量、服务统计数据
- 实现系统运行时间和版本信息
- 提供详细的错误诊断信息

## 实验流程

### 第一阶段：环境准备
1. 安装依赖包：`pip install -r requirements.txt`
2. 配置环境变量（API密钥、数据库连接等）
3. 启动Milvus向量数据库
4. 运行系统初始化脚本

### 第二阶段：功能实现
1. 按照任务顺序逐个实现TODO占位符
2. 每完成一个任务进行单元测试
3. 使用提供的测试数据验证功能
4. 调试和优化实现代码

### 第三阶段：系统集成
1. 启动完整的RAG系统
2. 通过Web界面测试各项功能
3. 上传测试文档并进行问答
4. 检查系统监控和统计信息

## 评分标准

### 功能完整性 (40%)
- 任务1：文档上传和处理 (8%)
- 任务2：文档向量化 (8%)
- 任务3：语义搜索实现 (8%)
- 任务4：RAG问答系统 (8%)
- 任务5：系统监控和健康检查 (8%)

### 代码质量 (30%)
- 代码规范性和可读性
- 异常处理和错误管理
- 性能优化和资源管理
- 注释和文档完整性

### 系统性能 (20%)
- 文档处理速度和准确性
- 搜索响应时间和相关性
- 问答质量和准确性
- 系统稳定性和可靠性

### 创新和扩展 (10%)
- 功能改进和优化
- 新特性的添加
- 用户体验的提升
- 技术方案的创新

## 提交要求

1. **代码提交**：完整的项目代码，包含所有实现的功能
2. **实验报告**：详细描述实现过程、遇到的问题和解决方案
3. **演示视频**：展示系统各项功能的运行效果
4. **测试结果**：包含单元测试和集成测试的结果

## 参考资源

- [实验操作手册](../lab01/lab01_操作手册.md)
- [最佳实践指南](../lab-best-practices.md)
- [API文档](http://localhost:8000/docs)
- [Milvus官方文档](https://milvus.io/docs)
- [FastAPI官方文档](https://fastapi.tiangolo.com/)

## 常见问题

### Q1: 如何配置API密钥？
A: 在`.env`文件中配置相应的API密钥，参考`.env.example`文件。

### Q2: Milvus连接失败怎么办？
A: 检查Milvus服务是否正常启动，确认连接配置是否正确。

### Q3: 文档上传失败如何处理？
A: 检查文件格式、大小限制，查看日志获取详细错误信息。

### Q4: 向量化过程很慢怎么优化？
A: 可以调整批处理大小，使用更快的嵌入模型，或启用GPU加速。

### Q5: 问答质量不高如何改进？
A: 优化文本分块策略，改进检索算法，调整提示模板和参数。

## 技术支持

如遇到技术问题，请：
1. 查看系统日志获取错误信息
2. 参考官方文档和最佳实践
3. 在课程论坛提问或寻求帮助
4. 联系助教获取技术支持

祝您实验顺利！