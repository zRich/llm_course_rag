# 教师讲稿 - Lesson 01：RAG系统概述与开发环境搭建

## 课程基本信息
- **总时长**: 120分钟（2课时）
- **授课方式**: 理论讲解 + 实践演示 + 学生操作
- **教学目标**: 理解RAG概念，掌握开发环境搭建

## 时间轴与授课脚本

### 第一课时（60分钟）

#### 开场导入（10分钟）

**教师开场白**（可直接照读）：
"同学们好！欢迎来到企业级RAG系统设计与实现课程。今天是我们的第一课，主要目标是让大家理解什么是RAG系统，为什么企业需要RAG，以及搭建我们的开发环境。

今天课程结束后，你们将能够：
1. 清楚解释RAG的核心概念和工作原理
2. 独立搭建完整的Python开发环境
3. 创建并运行第一个FastAPI应用

让我们先从一个问题开始：大家有没有使用过ChatGPT或其他AI助手？有没有发现它们有时候会给出过时的信息或者编造一些不存在的事实？"

**互动环节**：
- 提问：谁能举例说明AI助手给出错误信息的情况？
- 等待学生回应，记录2-3个典型例子
- 引导：这些问题的根源是什么？

#### RAG系统基础理论（25分钟）

**核心概念讲解**（15分钟）：

"刚才大家提到的问题，正是我们今天要解决的核心问题。RAG，全称Retrieval-Augmented Generation，中文叫检索增强生成，是解决这些问题的重要技术方案。

让我用一个简单的比喻来解释RAG：
- 想象你是一个律师，客户问你一个法律问题
- 传统的AI就像是凭记忆回答，可能记错或记不全
- 而RAG就像是先去查阅相关的法律条文，然后基于这些准确的资料来回答

RAG包含三个核心阶段："

**投屏展示RAG架构图**：
```
用户查询 → [检索阶段] → [增强阶段] → [生成阶段] → 最终答案
           ↓           ↓           ↓
        知识库检索   上下文整合   基于事实生成
```

"1. **检索阶段（Retrieval）**：根据用户的问题，从知识库中找到相关的文档片段
2. **增强阶段（Augmentation）**：将找到的信息整合到提示词中，为AI提供准确的上下文
3. **生成阶段（Generation）**：AI基于这些准确的信息生成回答"

**为什么需要RAG**（10分钟）：

"企业为什么要使用RAG？主要有五个原因：

1. **解决知识时效性问题**：AI模型的训练数据有截止时间，无法获取最新信息
2. **提供可验证的信息来源**：每个答案都能追溯到具体的文档来源
3. **降低AI幻觉**：基于真实文档生成答案，减少编造内容
4. **支持私有知识库**：企业内部文档、政策、流程等私有信息
5. **实现知识实时更新**：更新知识库即可更新AI的知识，无需重新训练模型"

**课堂提问与互动**：
- 提问：在你们的工作或学习中，哪些场景可能需要用到RAG？
- 参考答案：客服系统、技术文档查询、法律咨询、医疗诊断辅助、企业内部知识管理等

#### RAG系统关键模块（20分钟）

**模块架构讲解**：

"一个完整的RAG系统包含五个关键模块，让我逐一介绍：

**1. 文档处理模块**：
- 作用：将各种格式的文档（PDF、Word、网页等）转换为可处理的文本
- 关键技术：文档解析、文本清洗、内容分块
- 挑战：保持文档结构和语义完整性

**2. 向量化模块**：
- 作用：将文本转换为数学向量，使计算机能理解语义相似性
- 关键技术：词嵌入模型、句子编码器
- 示例：'苹果手机'和'iPhone'会被转换为相似的向量

**3. 检索模块**：
- 作用：根据用户查询快速找到最相关的文档片段
- 关键技术：向量相似度计算、索引优化
- 性能指标：检索速度、准确率、召回率

**4. 生成模块**：
- 作用：整合检索结果和用户查询，生成最终答案
- 关键技术：提示词工程、上下文管理
- 质量控制：答案相关性、事实准确性

**5. 评估模块**：
- 作用：监控系统性能，评估答案质量
- 关键指标：响应时间、用户满意度、答案准确性
- 持续优化：基于反馈改进系统"

**实际应用案例**：
"让我们看一个具体例子：
- 用户问：'公司的年假政策是什么？'
- 检索模块从HR文档中找到相关政策条款
- 生成模块基于这些条款生成清晰的回答
- 同时提供文档来源，用户可以查看原始政策"

#### 第一课时总结（5分钟）

"第一课时我们学习了：
1. RAG的核心概念：检索-增强-生成三阶段
2. 企业使用RAG的五大原因
3. RAG系统的五个关键模块

下半节课我们将学习如何搭建开发环境，为实现RAG系统做准备。"

### 第二课时（60分钟）

#### 技术栈介绍（15分钟）

**企业级技术选择**：

"现在我们来看看构建RAG系统需要哪些技术。我们的技术栈选择都基于企业级考虑：

**后端框架 - FastAPI**：
- 为什么选择：高性能、自动文档生成、类型安全
- 企业优势：异步支持、易于测试、丰富的生态
- 对比：比Flask性能更好，比Django更轻量

**向量数据库 - Qdrant**：
- 为什么选择：专为向量检索优化、支持过滤、高性能
- 企业优势：水平扩展、多租户支持、丰富的API
- 对比：比Pinecone更灵活，比Elasticsearch向量功能更强

**关系数据库 - PostgreSQL**：
- 为什么选择：企业级稳定性、丰富功能、开源
- 企业优势：ACID事务、复杂查询、扩展性
- 应用：存储用户数据、会话记录、系统配置

**包管理工具 - uv**：
- 为什么选择：速度极快（比pip快10-100倍）、现代化设计
- 企业优势：依赖解析准确、锁定文件支持、虚拟环境集成
- 对比演示：pip vs uv 安装速度对比"

#### 开发环境搭建实践（35分钟）

**环境准备演示**（10分钟）：

"现在我们开始实际操作。请大家跟着我的步骤：

**第一步：验证Python环境**"
```bash
# 检查Python版本
python --version
# 确保版本 >= 3.12
```

"如果版本不对，请按照课前准备文档安装正确版本。

**第二步：安装uv**"
```bash
# macOS/Linux
curl -LsSf https://astral.sh/uv/install.sh | sh

# Windows (PowerShell)
powershell -c "irm https://astral.sh/uv/install.ps1 | iex"

# 验证安装
uv --version
```

**重要提醒：配置国内源**

"在国内使用uv时，由于网络原因下载会很慢。我们需要配置国内镜像源："

```bash
# 创建uv配置目录
mkdir -p ~/.config/uv

# 配置清华大学镜像源
cat > ~/.config/uv/uv.toml << EOF
[global]
index-url = "https://pypi.tuna.tsinghua.edu.cn/simple"
extra-index-url = [
    "https://mirrors.aliyun.com/pypi/simple/",
    "https://pypi.douban.com/simple/"
]
EOF
```

"Windows用户的配置路径是 `%APPDATA%\uv\uv.toml`。

让我们测试一下配置是否生效："

```bash
# 测试安装速度
uv pip install requests
```

"大家可以看到，配置源之后安装速度明显提升。"

**项目初始化演示**（15分钟）：

"**第三步：创建项目**"
```bash
# 创建项目目录
mkdir exercise
cd exercise

# 初始化uv项目
uv init exercise

# 设置Python版本
uv python pin 3.12
```

"**第四步：安装依赖**"
```bash
# Web框架
uv add fastapi uvicorn[standard]

# 配置管理
uv add pydantic-settings python-dotenv

# 日志系统
uv add loguru

# 开发工具
uv add --dev ruff pytest httpx
```

"注意观察uv的安装速度，是不是比pip快很多？"

**项目结构创建**（10分钟）：

"**第五步：创建项目结构**"

现场演示创建以下目录和文件：
```
exercise/
├── app/
│   ├── __init__.py
│   ├── main.py
│   ├── core/
│   │   ├── __init__.py
│   │   ├── config.py
│   │   └── logging.py
│   └── api/
│       ├── __init__.py
│       └── health.py
├── tests/
│   ├── __init__.py
│   └── test_health.py
├── .env.example
├── .gitignore
└── README.md
```

#### FastAPI应用创建（10分钟）

**基础应用演示**：

"现在我们创建第一个FastAPI应用。在app/main.py中："

```python
from fastapi import FastAPI
from app.api.health import router as health_router

app = FastAPI(
    title="RAG Course API",
    description="企业级RAG系统开发课程",
    version="1.0.0"
)

app.include_router(health_router, prefix="/api/v1")

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8000)
```

"在app/api/health.py中："

```python
from fastapi import APIRouter
from pydantic import BaseModel

router = APIRouter()

class HealthResponse(BaseModel):
    status: str
    message: str

@router.get("/health", response_model=HealthResponse)
async def health_check():
    return HealthResponse(
        status="healthy",
        message="RAG系统运行正常"
    )
```

"启动应用："
```bash
uv run python -m app.main
```

"访问 http://localhost:8000/docs 查看自动生成的API文档"

## 课堂提问与练习

### 理论部分提问
1. **RAG的三个阶段分别是什么？各自的作用是什么？**
   - 参考答案：检索（从知识库找相关信息）、增强（整合信息到上下文）、生成（基于上下文生成答案）

2. **为什么企业需要RAG而不是直接使用ChatGPT？**
   - 参考答案：私有数据、实时更新、可追溯来源、降低幻觉、成本控制

3. **RAG系统的五个关键模块分别负责什么？**
   - 参考答案：文档处理、向量化、检索、生成、评估

### 实践部分练习
1. **环境验证练习**：学生独立验证Python版本和uv安装
2. **项目创建练习**：学生独立创建项目并安装依赖
3. **API测试练习**：学生访问健康检查接口并查看文档

## 常见误区与应对话术

### 误区1：RAG就是搜索引擎
**学生可能说**："RAG不就是搜索然后把结果给AI吗？"
**应对话术**："这是一个很好的问题。RAG确实包含搜索，但关键区别在于：搜索引擎返回文档列表让用户自己阅读，而RAG是将搜索结果作为上下文，让AI理解并生成针对性的回答。就像律师不是简单地给你一堆法条，而是基于法条给你专业的法律建议。"

### 误区2：uv只是另一个包管理器
**学生可能说**："uv和pip有什么本质区别吗？"
**应对话术**："从功能上看确实类似，但uv在企业环境中有三个关键优势：第一是速度，在大型项目中能节省大量时间；第二是依赖解析更准确，避免版本冲突；第三是内置虚拟环境管理，简化开发流程。在企业级开发中，这些优势会带来显著的效率提升。"

### 误区3：FastAPI学习成本高
**学生可能说**："FastAPI看起来比Flask复杂很多"
**应对话术**："初看确实如此，但FastAPI的复杂性主要体现在类型注解上，这实际上是优势。类型注解帮助我们：1）自动生成API文档；2）运行时数据验证；3）更好的IDE支持；4）减少bug。企业级开发中，这些特性能大大提高代码质量和维护效率。"

## 时间控制要点

- **严格控制理论讲解时间**：避免过度深入技术细节
- **预留充足实践时间**：确保每个学生都能完成环境搭建
- **设置检查点**：每个关键步骤后确认学生进度
- **准备应急方案**：对于环境问题提供快速解决方案

## 课堂管理建议

- **分组协作**：让完成快的学生帮助其他同学
- **实时反馈**：通过举手或在线工具收集学生状态
- **问题记录**：记录常见问题，为后续课程优化提供参考
- **进度调整**：根据实际情况灵活调整讲解深度和实践时间