# Lesson 17 黑板/投屏操作步骤：结构化数据接入

本步骤用于课堂演示与逐步检查，确保连接器、字段映射、增量与幂等、检查点与并发控制均可观测、可复现。

## 演示前准备
- 打开 `lesson17_结构化数据接入/examples/input_structured.json`，快速浏览连接器配置、字段映射与增量键。
- 准备小型数据源：
  - PostgreSQL/SQLite `users` 表（含 `id`, `name`, `email`, `updated_at`）。
  - 模拟订单 API（或本地 JSON）`orders`（含 `order_id`, `user_id`, `amount`, `updated_at`）。
- 清理目标命名空间（如 `namespace=prod_users_orders`）以保证干净的首次全量演示。

## 逐步演示
1) 连接器配置与加载
   - 展示 APIConnector/DatabaseConnector 初始化参数（超时、重试、分页）。
   - 说明速率限制与并发设置的默认值与上限。

2) 字段映射与标准化
   - 打开映射片段：源字段 → 标准文档 `{title, body, metadata}`。
   - 演示特殊值清洗/类型转换（如 `amount` 转为 `float`）。

3) 首次全量接入
   - 运行批处理：分批抓取 `users` 与 `orders`，合并到标准文档。
   - 投屏日志关键字段：批次大小、成功/失败计数、端到端耗时、幂等拦截数。

4) 增量更新验证
   - 在源端新增用户或更新订单金额；再次运行仅抓取变更。
   - 展示检查点（增量键偏移/时间戳）与重复写入的幂等阻断。

5) 故障注入
   - API 限流：返回 429，观察指数退避与恢复。
   - 网络抖动：模拟超时，展示重试与检查点保护。
   - 模式变更：为 `users` 新增列 `phone`，展示映射的兼容策略（忽略/版本化）。

6) 再次运行与恢复
   - 再次运行批次，验证断点续传；确保成功率与耗时在预期范围。

## 检查点与收尾
- 展示并解释：增量键、检查点持久化位置与格式。
- 汇总计数器：写入成功/失败、重试成功率、重复拦截率。
- 归档演示日志与截图，提醒学生提交模板要求。