# Lesson 02 - 容器化与依赖服务启动

## 课次信息
- **课次编号**: Lesson 02
- **模块编号**: Module A - 基础设施与环境搭建
- **预计时长**: 90分钟
- **前置依赖**: Lesson 01（Python环境、FastAPI基础应用）
- **后置产出**: 完整的容器化RAG系统开发环境

## 教学目标（SMART）

### S (Specific) - 具体目标
学生能够在企业级RAG系统开发场景中，正确使用Docker容器化技术搭建完整的开发环境，并通过容器编排启动所有依赖服务。

### M (Measurable) - 可测量指标
- Docker镜像构建成功率 ≥ 95%
- 服务启动成功率 ≥ 90%
- 服务间连通性测试通过率 ≥ 85%
- 实验完成时间 ≤ 75分钟

### A (Achievable) - 可实现性
在限定的90分钟内，使用Docker Desktop和提供的配置文件，独立完成端到端的容器化部署。

### R (Relevant) - 相关性
与Module A目标一致，为后续的数据模型设计和RAG系统开发提供稳定的基础设施环境。

### T (Time-bound) - 时间限制
90分钟内完成所有实验任务并通过验收测试。

## 教学重点
- **Docker容器化概念**：镜像、容器、仓库的核心概念
- **Dockerfile编写**：多阶段构建、最佳实践、安全配置
- **Docker Compose编排**：多服务定义、网络配置、数据持久化
- **企业级服务架构**：PostgreSQL、Redis、Qdrant、MinIO的角色和配置

## 教学难点
- **服务间网络通信**：容器网络配置和服务发现机制
- **数据持久化策略**：卷挂载、数据备份和恢复
- **环境变量管理**：敏感信息保护和配置隔离
- **故障排查技能**：日志分析、连接测试、性能调优

## 知识点详解

### 1. 容器化技术基础
- **概念解释**: 操作系统级虚拟化技术，提供轻量级的应用隔离
- **核心优势**: 环境一致性、资源效率、可移植性、可扩展性
- **应用场景**: 微服务架构、CI/CD流水线、云原生应用

### 2. Docker核心组件
- **Docker Engine**: 容器运行时和API服务
- **Docker CLI**: 命令行管理工具
- **Docker Hub**: 官方镜像仓库和分发平台

### 3. Dockerfile最佳实践
- **基础镜像选择**: 官方镜像、安全更新、大小优化
- **层缓存优化**: 指令顺序、合并命令、.dockerignore
- **安全配置**: 非root用户、最小权限、漏洞扫描

### 4. Docker Compose服务编排
- **服务定义**: 镜像、端口、环境变量、依赖关系
- **网络配置**: 自定义网络、服务发现、负载均衡
- **数据管理**: 命名卷、绑定挂载、数据备份

## 完整示例与演示

### 输入示例
```bash
# 项目初始化
mkdir exercise && cd exercise
git clone <rag-system-repo>
cd rag-system && git checkout lesson02
```

### 期望输出
```bash
# 服务启动成功
✓ PostgreSQL: Running on port 5432
✓ Redis: Running on port 6379  
✓ Qdrant: Running on port 6333
✓ MinIO: Running on port 9000
✓ FastAPI App: Running on port 8000
```

### 异常场景与兜底
- **端口冲突**: 自动检测并使用备用端口
- **内存不足**: 提供轻量级配置选项
- **网络问题**: 离线镜像和本地构建方案

## 文档导航

### 必须文件
- [教师讲稿](./teacher-script.md) - 详细的授课脚本和话术
- [黑板演示步骤](./blackboard-steps.md) - 逐步操作指导
- [提交检查清单](./checklist.md) - 验收标准和自检项目
- [演示代码](./examples/) - 课堂演示用的配置文件
- [学生模板](./templates/) - 实验提交模板

### 学生资源
- [学生实验指导](./学生实验指导.md) - 详细的实验步骤和说明
- [教师讲义](./教师讲义.md) - 理论知识和概念解释

## 学生任务

### 课堂任务
1. **Docker环境验证** (10分钟)
   - 安装并启动Docker Desktop
   - 运行hello-world容器测试

2. **Exercise 1: Dockerfile编写** (20分钟)
   - 为FastAPI应用创建Dockerfile
   - 构建并测试应用镜像

3. **Exercise 2: 服务编排配置** (25分钟)
   - 编写docker-compose.yml
   - 配置PostgreSQL和Redis服务

### 课后任务
1. **Lab 02: 完整服务栈部署** (必做)
   - 添加Qdrant和MinIO服务
   - 实现数据持久化配置
   - 验证服务间连通性

2. **扩展练习: 监控系统集成** (选做)
   - 添加Prometheus和Grafana
   - 配置基础监控指标

## 对齐与连续性

### 与Module A的锚点
- **环境标准化**: 统一的开发环境配置
- **服务架构**: 为后续模块提供基础设施
- **最佳实践**: 企业级部署和运维规范

### 承接Lesson 01
- **复用FastAPI应用**: 将lesson01的应用容器化
- **环境配置**: 基于已有的Python环境和依赖

### 引出Lesson 03
- **数据库准备**: PostgreSQL容器为数据模型设计做准备
- **连接配置**: 为SQLModel集成提供数据库连接

## 提交与验收

### 评估标准
- **功能完整性** (40%): 所有服务正常启动和运行
- **配置正确性** (30%): Docker配置符合最佳实践
- **文档质量** (20%): 清晰的部署说明和故障排查
- **创新性** (10%): 额外的优化和改进

### 验收阈值
- 服务启动成功率 ≥ 90%
- 健康检查通过率 ≥ 95%
- 响应时间 ≤ 2秒
- 内存使用率 ≤ 80%

### 不可虚构声明
- 不得编造未实现的监控指标
- 不得虚报服务性能数据
- 必须提供真实的测试结果截图

## 术语与概念定义

### 核心概念
- **容器化**: 将应用及其依赖打包成可移植的容器
- **镜像**: 只读的容器模板，包含应用运行环境
- **服务编排**: 定义和管理多容器应用的工具和方法

### 技术术语
- **Dockerfile**: 构建Docker镜像的脚本文件
- **docker-compose.yml**: 定义多服务应用的配置文件
- **Volume**: Docker的数据持久化机制

### 评估标准
- **健康检查**: 验证服务运行状态的机制
- **服务发现**: 容器间通过服务名进行通信
- **数据持久化**: 确保数据在容器重启后不丢失

## 边界声明

### 本课不覆盖
- **Kubernetes编排**: 企业级容器编排平台
- **Docker Swarm**: Docker原生集群管理
- **高级网络配置**: 跨主机网络、服务网格
- **生产环境部署**: CI/CD流水线、蓝绿部署

### 外部依赖
- **Docker Desktop**: 需要预先安装并配置
- **网络连接**: 拉取镜像需要稳定的网络
- **系统资源**: 至少8GB内存和10GB存储空间

### 替代方案
- **本地安装**: 直接在主机上安装各种服务
- **虚拟机**: 使用VM隔离不同的服务环境
- **云服务**: 使用托管的数据库和存储服务