å¥½çš„ï¼Œæˆ‘ä»¬ç»§ç»­ï¼Œä¸‹é¢æ˜¯ **æ¨¡å—Cï¼ˆIngestionå·¥ç¨‹åŒ–ï¼ŒLesson 15â€“20ï¼‰** çš„è¯¦ç»†è®²ä¹‰ + å­¦ç”Ÿå®éªŒæŒ‡å¯¼ + æ€è€ƒé¢˜ç‰ˆæœ¬ã€‚

---

# æ¨¡å—Cï¼šIngestionå·¥ç¨‹åŒ–ï¼ˆLesson 15â€“20ï¼‰

---

## Lesson 15 â€“ æ‰¹é‡/æ–­ç‚¹ç»­ä¼ 

### ğŸ“ æ•™å¸ˆè®²ä¹‰è¦ç‚¹

* **è¯¾ç¨‹ç›®æ ‡**ï¼šå®ç°å¤§è§„æ¨¡æ–‡æ¡£çš„æ‰¹é‡å¤„ç†ä¸æ–­ç‚¹ç»­ä¼ ï¼Œæé«˜ç³»ç»Ÿç¨³å®šæ€§ã€‚
* **æŠ€æœ¯é‡ç‚¹**ï¼š

  * å¼‚æ­¥æ‰¹é‡å¤„ç†ï¼ˆasyncio + FastAPI Background Tasksï¼‰
  * æ–­ç‚¹ç»­ä¼ æœºåˆ¶è®¾è®¡
  * å¤„ç†è¿›åº¦è·Ÿè¸ªä¸æ—¥å¿—è®°å½•
  * é”™è¯¯æ¢å¤ç­–ç•¥

### ğŸ§ª å­¦ç”Ÿå®éªŒæŒ‡å¯¼

```python
from fastapi import BackgroundTasks
import asyncio

async def process_document(doc_id):
    # æ¨¡æ‹Ÿå¤„ç†
    await asyncio.sleep(0.1)
    print(f"Processed {doc_id}")

async def batch_process(doc_ids):
    tasks = [process_document(d) for d in doc_ids]
    for i, task in enumerate(asyncio.as_completed(tasks), 1):
        await task
        print(f"Progress: {i}/{len(doc_ids)}")

# FastAPI background task
def start_batch(background_tasks: BackgroundTasks, doc_ids):
    background_tasks.add_task(batch_process, doc_ids)
```

### ğŸ¤” æ€è€ƒé¢˜

1. æ‰¹é‡å¤„ç†å¤§è§„æ¨¡æ–‡æ¡£æ—¶ï¼Œå¦‚ä½•ä¿è¯ç³»ç»Ÿä¸ä¼šå› å†…å­˜è¿‡è½½å´©æºƒï¼Ÿ
2. æ–­ç‚¹ç»­ä¼ çš„å…³é”®ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ

---

## Lesson 16 â€“ å¢é‡æ›´æ–°

### ğŸ“ æ•™å¸ˆè®²ä¹‰è¦ç‚¹

* **è¯¾ç¨‹ç›®æ ‡**ï¼šå®ç°æ–‡æ¡£å¢é‡æ›´æ–°ï¼Œæé«˜ç´¢å¼•ä¸æ£€ç´¢æ•ˆç‡ã€‚
* **æŠ€æœ¯é‡ç‚¹**ï¼š

  * å˜æ›´æ£€æµ‹ç®—æ³•
  * å¢é‡ç´¢å¼•æ›´æ–°ï¼ˆå‘é‡åº“/å…¨æ–‡ç´¢å¼•ï¼‰
  * æ–‡æ¡£ç‰ˆæœ¬æ§åˆ¶
  * å†²çªè§£å†³ç­–ç•¥

### ğŸ§ª å­¦ç”Ÿå®éªŒæŒ‡å¯¼

```python
# å‡è®¾æ¯ä¸ªæ–‡æ¡£æœ‰ version
def update_index(new_doc):
    existing = get_doc_by_id(new_doc.id)
    if not existing or existing.version < new_doc.version:
        # æ›´æ–°ç´¢å¼•
        index_vector(new_doc)
```

### ğŸ¤” æ€è€ƒé¢˜

1. å¦‚ä½•è®¾è®¡æ–‡æ¡£çš„ç‰ˆæœ¬å·ä¸æ›´æ–°ç­–ç•¥ï¼Ÿ
2. å¢é‡æ›´æ–°å¦‚ä½•å‡å°‘ç³»ç»Ÿè´Ÿè½½ï¼Ÿ

---

## Lesson 17 â€“ ç»“æ„åŒ–æ•°æ®æ¥å…¥

### ğŸ“ æ•™å¸ˆè®²ä¹‰è¦ç‚¹

* **è¯¾ç¨‹ç›®æ ‡**ï¼šæ”¯æŒç»“æ„åŒ–æ•°æ®æºæ¥å…¥ï¼Œå¦‚æ•°æ®åº“æˆ– APIã€‚
* **æŠ€æœ¯é‡ç‚¹**ï¼š

  * æ•°æ®åº“è¿æ¥å™¨ä¸æŸ¥è¯¢
  * REST / GraphQL API æ•°æ®æºé›†æˆ
  * æ•°æ®æ ¼å¼è½¬æ¢ä¸æ¸…æ´—
  * å®æ—¶æ•°æ®åŒæ­¥

### ğŸ§ª å­¦ç”Ÿå®éªŒæŒ‡å¯¼

```python
import requests
import pandas as pd

# ä» API è·å–æ•°æ®
response = requests.get("https://api.example.com/data")
data = pd.DataFrame(response.json())

# è½¬æ¢ä¸º RAG ç³»ç»Ÿå¯ç”¨æ ¼å¼
for _, row in data.iterrows():
    doc = {"content": row["text"], "metadata": {"source": "api"}}
    index_vector(doc)
```

### ğŸ¤” æ€è€ƒé¢˜

1. å¦‚ä½•ä¿è¯å®æ—¶æ•°æ®åŒæ­¥çš„ç¨³å®šæ€§å’Œä¸€è‡´æ€§ï¼Ÿ
2. ç»“æ„åŒ–æ•°æ®æ¥å…¥å’Œéç»“æ„åŒ–æ–‡æ¡£æœ‰ä½•å·®å¼‚ï¼Ÿ

---

## Lesson 18 â€“ æ–‡æœ¬æ¸…æ´—ä¸å»å™ª

### ğŸ“ æ•™å¸ˆè®²ä¹‰è¦ç‚¹

* **è¯¾ç¨‹ç›®æ ‡**ï¼šæå‡æ–‡æ¡£è´¨é‡ï¼Œå‡å°‘å™ªå£°ï¼Œæé«˜æ£€ç´¢å’Œç”Ÿæˆæ•ˆæœã€‚
* **æŠ€æœ¯é‡ç‚¹**ï¼š

  * æ–‡æœ¬é¢„å¤„ç†ç®—æ³•ï¼ˆå»ç©ºæ ¼ã€å»ç‰¹æ®Šå­—ç¬¦ï¼‰
  * å™ªå£°æ£€æµ‹ä¸æ¸…ç†
  * æ–‡æœ¬è´¨é‡è¯„ä¼°æŒ‡æ ‡
  * è‡ªåŠ¨åŒ–æ¸…æ´—æµç¨‹

### ğŸ§ª å­¦ç”Ÿå®éªŒæŒ‡å¯¼

```python
import re

def clean_text(text):
    # å»æ‰å¤šä½™ç©ºæ ¼
    text = re.sub(r'\s+', ' ', text)
    # å»æ‰éæ–‡å­—å­—ç¬¦
    text = re.sub(r'[^\u4e00-\u9fa5A-Za-z0-9.,;!?]', '', text)
    return text

cleaned = [clean_text(doc["content"]) for doc in documents]
```

### ğŸ¤” æ€è€ƒé¢˜

1. æ¸…æ´—è¿‡åº¦ä¼šä¸ä¼šå½±å“ä¿¡æ¯å®Œæ•´æ€§ï¼Ÿ
2. å¦‚ä½•è‡ªåŠ¨è¯„ä¼°æ–‡æœ¬æ¸…æ´—æ•ˆæœï¼Ÿ

---

## Lesson 19 â€“ åˆ‡åˆ†ç­–ç•¥æ’ä»¶åŒ–

### ğŸ“ æ•™å¸ˆè®²ä¹‰è¦ç‚¹

* **è¯¾ç¨‹ç›®æ ‡**ï¼šæ„å»ºå¯æ‰©å±•çš„æ–‡æœ¬åˆ‡åˆ†ç­–ç•¥ç³»ç»Ÿã€‚
* **æŠ€æœ¯é‡ç‚¹**ï¼š

  * æ’ä»¶åŒ–æ¶æ„è®¾è®¡
  * ç­–ç•¥æ³¨å†Œæœºåˆ¶
  * åŠ¨æ€ç­–ç•¥é€‰æ‹©
  * æ€§èƒ½åŸºå‡†æµ‹è¯•

### ğŸ§ª å­¦ç”Ÿå®éªŒæŒ‡å¯¼

```python
# å®šä¹‰æ¥å£
class ChunkStrategy:
    def split(self, text):
        raise NotImplementedError

# æ’ä»¶æ³¨å†Œ
strategies = {}
def register_strategy(name, cls):
    strategies[name] = cls()

# ä½¿ç”¨ç­–ç•¥
register_strategy("fixed_200", lambda: ChunkStrategy())
chunks = strategies["fixed_200"].split(text)
```

### ğŸ¤” æ€è€ƒé¢˜

1. ä¸ºä»€ä¹ˆæ’ä»¶åŒ–ç­–ç•¥æ¯”ç¡¬ç¼–ç ç­–ç•¥æ›´çµæ´»ï¼Ÿ
2. å¦‚ä½•é€‰æ‹©æœ€ä¼˜åˆ‡åˆ†ç­–ç•¥ï¼Ÿ

---

## Lesson 20 â€“ æ•…éšœæ³¨å…¥ä¸æ¢å¤æ¼”ç»ƒ

### ğŸ“ æ•™å¸ˆè®²ä¹‰è¦ç‚¹

* **è¯¾ç¨‹ç›®æ ‡**ï¼šæå‡ç³»ç»Ÿå¯é æ€§å’Œå®¹é”™èƒ½åŠ›ã€‚
* **æŠ€æœ¯é‡ç‚¹**ï¼š

  * æ•…éšœæ³¨å…¥æ¡†æ¶
  * è‡ªåŠ¨æ¢å¤æœºåˆ¶
  * ç›‘æ§ä¸å‘Šè­¦
  * ç¾éš¾æ¢å¤æ¼”ç»ƒ

### ğŸ§ª å­¦ç”Ÿå®éªŒæŒ‡å¯¼

```python
import random

def inject_failure():
    if random.random() < 0.1:  # 10% æ¦‚ç‡æ¨¡æ‹Ÿå¤±è´¥
        raise Exception("Simulated failure")

# ä½¿ç”¨æ¢å¤æœºåˆ¶
try:
    inject_failure()
    process_document(doc)
except Exception as e:
    print("Error occurred, retrying...")
    retry_process(doc)
```

### ğŸ¤” æ€è€ƒé¢˜

1. æ•…éšœæ³¨å…¥ä¸ºä»€ä¹ˆå¯¹ç³»ç»Ÿç¨³å®šæ€§æµ‹è¯•é‡è¦ï¼Ÿ
2. å¦‚ä½•è®¾è®¡è‡ªåŠ¨æ¢å¤ç­–ç•¥ï¼Œä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Ÿ

---

æˆ‘å·²å®Œæˆ **æ¨¡å—Cï¼ˆLesson 15â€“20ï¼‰è¯¦ç»†è®²ä¹‰ + å®éªŒæŒ‡å¯¼**ã€‚

æ˜¯å¦ç°åœ¨ç»§ç»­ **æ¨¡å—Dï¼ˆç”Ÿæˆæ§åˆ¶ä¸é˜²å¹»è§‰ï¼ŒLesson 21â€“26ï¼‰**ï¼Ÿ
