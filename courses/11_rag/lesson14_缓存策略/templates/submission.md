# Lesson 14 · 提交模板（缓存策略）

请按本模板整理你的实验报告，确保助教可在本机端到端复现全部结论。

## 1. 项目与环境
- 代码仓库地址：
- 运行环境：OS/CPU/GPU/依赖版本（模型/向量库/框架）
- `.env` 关键项：
  - `CACHE_ENABLED=`
  - `CACHE_TTL_SEC=`
  - `CACHE_KEY_FIELDS=`
  - `CACHE_LAYERS=`
  - 其他：`tenant_id`、索引/模型/提示版本等

## 2. 键设计与标准化
- 列出覆盖的键字段（查询、过滤、top_k、fusion.strategy、rerank_top_m、模型、提示、样式、租户等）。
- 文本归一策略（大小写/空白/正则）；结构化字段规范序列化（Canonical JSON）。

## 3. 预热与问题集
- 问题集来源与规模：Top-N 热问 + 长尾问。
- 预热脚本与调用量：附运行命令与日志片段。

## 4. 端到端验证（基线 vs 开启缓存）
- 数据采集方法：如何统计命中/未命中与分层；如何测量 P95 延时与成本。
- 指标对比表：

| 指标 | Baseline | Cache Enabled | 变化 |
| --- | --- | --- | --- |
| 命中率（总体/分层） |  |  |  |
| P95 延时（ms） |  |  |  |
| 成本（调用量/费用） |  |  |  |

- 关键截图：日志 `cache_hit=true/false`、监控面板、响应片段（含引用）。

## 5. 一致性与引用核验
- 抽样比例与方法：随机抽样不少于 20 条。
- 结果：命中后的答案与引用字段一致；不可定位引用不得缓存（如被命中需解释并修复）。

## 6. 失效与更新演示
- 文档/索引/提示/模型版本变更的失效策略与脚本。
- 变更前后同参调用的 miss→hit→miss 观察与证据。

## 7. 风险与边界
- 多租户隔离策略：键空间包含 `tenant_id/user_id`；无跨租户污染证据。
- 雪崩与抖动：TTL 随机抖动配置与效果。
- 数据隐私与合规：敏感数据不被缓存或采用短 TTL/加密。

## 8. 复现步骤
- 环境准备 → 预热 → 首次调用（miss）→ 二次调用（hit）→ 失效 → 重试（miss）。
- 逐步命令与期望输出（可引用 `examples/input.json`）。

## 9. 结论与建议
- 是否达成目标：命中率≥70%（热问）、P95 延时下降≥30%、成本下降≥20%。
- 下一步优化：键覆盖完善、冷热分层与容量规划、指标采集与监控面板完善。

## 10. 附录
- 原始日志与脚本：包含关键 trace_id、`cache_hit` 埋点、耗时与成本计算。
- 配置文件与版本清单：模型/索引/提示版本、依赖版本。

> 声明：严禁虚构或伪造数据与截图；一经发现不予通过。