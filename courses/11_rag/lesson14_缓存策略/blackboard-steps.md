# Lesson 14 · 黑板/投屏步骤（缓存策略）

## 1) 课前准备
- 打开配置片段：`CACHE_ENABLED=true`、`CACHE_TTL_SEC=300`、`CACHE_KEY_FIELDS=[...]`。
- 准备 Top-10 热问列表用于预热与演示。

## 2) 首次调用（Miss）
- 投屏终端：执行检索与 QA 两个请求（参见 `examples/input.json` 前两条）。
- 展示日志：`cache_hit=false`（分层：retrieve/qa）；记录延时与成本。
- 展示输出：答案与引用字段（`citations`/`source_id`/`span`）一致且可定位。

## 3) 二次调用（Hit）
- 重复同参调用（参见 `examples/input.json` 后两条）。
- 展示日志：`cache_hit=true`；对比 P95 延时与成本下降。
- 强调：命中后答案与引用保持一致，字段命名不变。

## 4) 预热与命中率
- 运行预热脚本：批量调用 Top-10 热问（只需一次）。
- 展示命中率计算公式与对比表：`hits/(hits+misses)`；分层统计。

## 5) 失效演示
- 修改一份源文档或更新索引版本。
- 触发主动失效：清理相关键空间。
- 再次调用：观察 `miss`，答案与引用更新。

## 6) 伪命中诊断
- 举例：`filters` 字段顺序不同导致键不一致。
- 展示 `examples/error_response.json`；说明规范序列化与键覆盖要点。

## 一致性检查点（课堂实时勾选）
- 引用字段命名与样式与 Lesson 13 一致。
- 命中后答案与引用一致；不可定位引用不得缓存。
- TTL 具备抖动以避免雪崩；模型/提示/索引版本变更触发失效。