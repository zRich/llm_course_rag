# Lesson 07：关键词检索优化

## 课次信息
- 课次编号：Lesson 07
- 模块编号：Module B - 检索技术优化
- 时长：90 分钟
- 前置：Lesson 06（基础向量检索系统，产出：可运行的RAG系统）
- 后置：Lesson 08（混合检索策略，将复用：关键词检索函数、分词技术）

## 教学目标（SMART）
- **S**：能在PostgreSQL环境中正确实现中文关键词检索功能，并通过jieba分词优化搜索效果
- **M**：关键词检索准确率 ≥ 80%；中文分词效果评估 ≥ 85%；检索响应时间 ≤ 200ms
- **A**：在限定时间与PostgreSQL+Python环境内，独立完成端到端关键词检索实现
- **R**：与模块目标一致，服务RAG系统检索技术优化主线
- **T**：90分钟内完成并验收关键词检索功能

## 教学重点
- PostgreSQL全文检索（GIN索引、to_tsvector、to_tsquery）
- jieba中文分词技术与效果优化
- 关键词检索与向量检索的技术对比
- 关键词搜索函数的实现与集成

## 教学难点
- 中文分词的准确性与一致性问题，化解策略：标准化分词流程
- PostgreSQL全文检索配置与性能优化，化解策略：逐步演示索引创建
- 关键词检索与向量检索的适用场景区分，化解策略：对比演示

## 知识点详解

### 1. PostgreSQL全文检索基础
- **概念**：基于文本内容的精确匹配和模糊匹配检索
- **核心函数**：`to_tsvector()`、`to_tsquery()`、`@@`操作符
- **索引类型**：GIN索引用于全文检索性能优化
- **输入示例**：`SELECT * FROM documents WHERE to_tsvector('chinese', content) @@ to_tsquery('chinese', '人工智能')`
- **输出**：匹配的文档记录集合
- **错误路径**：分词配置错误、索引缺失、查询语法错误

### 2. jieba中文分词技术
- **概念**：基于统计和规则的中文文本分词工具
- **分词模式**：精确模式、全模式、搜索引擎模式
- **输入示例**：`jieba.cut("人工智能技术发展", cut_all=False)`
- **输出**：`['人工智能', '技术', '发展']`
- **错误路径**：编码问题、自定义词典加载失败

### 3. 关键词检索实现
- **预处理函数**：`preprocess_query(query)` - 查询文本分词处理
- **搜索函数**：`keyword_search(query, limit)` - 执行关键词检索
- **集成方式**：与现有RAG系统的检索接口对接
- **性能优化**：缓存分词结果、批量查询优化

## 完整示例与演示

### 输入样例
```python
# 查询示例
query = "人工智能在医疗领域的应用"
limit = 5

# 预期的分词结果
tokens = ['人工智能', '医疗', '领域', '应用']
```

### 期望输出
```python
# 检索结果格式
{
    "results": [
        {
            "id": "doc_001",
            "content": "人工智能技术在医疗诊断中...",
            "score": 0.85,
            "matched_keywords": ["人工智能", "医疗"]
        }
    ],
    "total": 12,
    "query_time": "0.15s"
}
```

### 异常与兜底
- **空查询处理**：返回错误提示和建议查询格式
- **无结果处理**：提供相关推荐或扩展搜索建议
- **分词失败**：回退到原始查询字符串匹配

## 授课老师指导

### 时间轴与脚本
- **导入阶段**（15分钟）：回顾向量检索，引入关键词检索概念
- **讲解阶段**（35分钟）：PostgreSQL全文检索、jieba分词演示
- **实践阶段**（30分钟）：学生动手实现关键词检索功能
- **总结阶段**（10分钟）：对比两种检索方式，预告下节课内容

### 提问与互动
- **概念理解**：关键词检索与向量检索的主要区别是什么？
- **技术应用**：什么场景下应该选择关键词检索？
- **实践操作**：如何验证jieba分词的效果？

## 学生任务
- **课堂任务**：完成jieba分词测试，创建PostgreSQL全文检索索引
- **课后任务**：实现完整的关键词检索功能，集成到现有RAG系统

## 对齐与连续性
- **与Module B对齐**：检索技术优化模块的核心组件
- **承接Lesson 06**：在向量检索基础上增加关键词检索能力
- **引出Lesson 08**：为混合检索策略提供关键词检索组件

## 提交与验收
- **评估标准**：功能完整性（40%）、性能指标（30%）、代码质量（30%）
- **验收标准**：关键词检索功能正常运行，分词效果符合预期，响应时间达标
- **一致性检查**：函数命名、错误处理、返回格式与课程规范一致

## 边界声明
- **本课不覆盖**：复杂的NLP预处理、自定义分词算法、分布式检索
- **外部依赖**：jieba库、PostgreSQL数据库、现有文档数据

---

## 文档导航
- [教师讲稿](teacher-script.md) - 可直接照读的授课脚本
- [黑板操作步骤](blackboard-steps.md) - 逐步演示指导
- [课堂提问](questions.md) - 互动问题与参考答案
- [术语定义](terminology.md) - 核心概念解释
- [验收标准](acceptance.md) - 详细评估标准
- [检查清单](checklist.md) - 提交前核对项目
- [课堂示例](examples/) - 演示用代码和数据
- [提交模板](templates/) - 学生作业模板