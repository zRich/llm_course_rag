# 第七课：关键词检索优化 - 教师讲义

## 📚 课程概述

**课程时长**：45分钟  
**理论讲解**：15分钟  
**演示操作**：15分钟  
**学生实验**：15分钟  

本课程在lesson06向量检索的基础上，引入PostgreSQL全文检索功能，让学生理解关键词检索与向量检索的区别，为下节课的混合检索做准备。

**课程目标**：
- 理解关键词检索的基本原理
- 掌握PostgreSQL全文检索的基础用法
- 学会jieba中文分词的简单应用
- 实现一个基础的关键词搜索功能

---

## 🎯 教学重点（理论15分钟）

### 1. 关键词检索 vs 向量检索（5分钟）

**关键词检索特点**：
- 基于精确词汇匹配
- 适合专有名词、技术术语
- 查询速度快，结果可解释
- 例如：搜索"PostgreSQL"会精确匹配包含该词的文档

**向量检索特点**：
- 基于语义相似性
- 适合概念性查询
- 能理解同义词和相关概念
- 例如：搜索"数据库"可能匹配到"MySQL"、"存储"等相关内容

**互补性**：两种方式各有优势，结合使用效果更好

### 2. PostgreSQL全文检索基础（5分钟）

**核心概念**：
- `tsvector`：文档的向量化表示
- `tsquery`：查询的向量化表示
- `@@`操作符：匹配操作
- `ts_rank`：相关性评分

**基本语法**：
```sql
-- 创建文档向量
SELECT to_tsvector('这是一个测试文档');

-- 创建查询向量
SELECT to_tsquery('测试');

-- 执行匹配
SELECT to_tsvector('这是一个测试文档') @@ to_tsquery('测试');
```

### 3. 中文分词挑战（5分钟）

**问题**：中文没有天然的词汇分隔符
**解决方案**：使用jieba分词库

**jieba基本用法**：
```python
import jieba

# 精确分词
words = jieba.lcut("我爱自然语言处理")
print(words)  # ['我', '爱', '自然语言处理']

# 搜索引擎模式
words = jieba.lcut_for_search("我爱自然语言处理")
print(words)  # ['我', '爱', '自然', '语言', '处理', '自然语言处理']
```

---

## 🔧 演示操作（15分钟）

### 演示1：PostgreSQL全文检索（8分钟）

```sql
-- 1. 查看现有文档表
SELECT id, title, LEFT(content, 100) as content_preview 
FROM documents LIMIT 3;

-- 2. 添加全文检索字段
ALTER TABLE documents ADD COLUMN content_vector tsvector;

-- 3. 更新向量字段
UPDATE documents 
SET content_vector = to_tsvector('simple', title || ' ' || content);

-- 4. 创建索引
CREATE INDEX idx_content_vector ON documents USING gin(content_vector);

-- 5. 执行搜索
SELECT id, title, ts_rank(content_vector, to_tsquery('simple', 'python')) as score
FROM documents 
WHERE content_vector @@ to_tsquery('simple', 'python')
ORDER BY score DESC
LIMIT 5;
```

### 演示2：jieba分词效果（7分钟）

```python
# 创建简单的分词测试脚本
import jieba

def demo_segmentation():
    test_text = "人工智能和机器学习是现代科技的重要组成部分"
    
    print(f"原文：{test_text}")
    
    # 精确模式
    words1 = jieba.lcut(test_text)
    print(f"精确模式：{' / '.join(words1)}")
    
    # 搜索模式
    words2 = jieba.lcut_for_search(test_text)
    print(f"搜索模式：{' / '.join(words2)}")
    
    # 为PostgreSQL准备
    search_text = ' '.join(words2)
    print(f"搜索文本：{search_text}")

if __name__ == "__main__":
    demo_segmentation()
```

---

## 📝 学生实验指导（15分钟）

学生将基于lesson06的代码，添加简单的关键词搜索功能：

1. **环境准备**（2分钟）：切换到lesson07分支
2. **安装依赖**（3分钟）：安装jieba分词库
3. **数据库扩展**（5分钟）：添加tsvector字段和索引
4. **简单搜索**（5分钟）：实现基础的关键词搜索接口

**预期成果**：学生能够实现一个基本的关键词搜索功能，理解全文检索的工作原理。

---

## 🔗 课程衔接

**与lesson06的连接**：
- 继续使用相同的数据库和文档
- 在现有向量检索基础上添加关键词检索
- 保持代码结构的一致性

**为lesson08做准备**：
- 下节课将学习如何融合关键词检索和向量检索
- 学生将理解两种检索方式的优缺点
- 为混合检索策略打下基础

---

## 📚 课后思考

1. 什么情况下关键词检索比向量检索更有效？
2. 如何评估关键词检索的效果？
3. 中文分词的准确性如何影响搜索结果？

---

## 📖 参考资料

- [PostgreSQL全文检索文档](https://www.postgresql.org/docs/current/textsearch.html)
- [jieba分词库](https://github.com/fxsjy/jieba)
- [全文检索基础教程](https://use-the-index-luke.com/)