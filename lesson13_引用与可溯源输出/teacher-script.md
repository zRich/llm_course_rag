# Lesson 13 讲稿（Teacher Script）— 引用与可溯源输出

## 时间轴与流程
- 0–10 min：导入与目标说明（为何需要带引用的答案）。
- 10–30 min：概念讲解（输出契约、引用样式、定位字段、一致性检查）。
- 30–75 min：实践环节（≥3条问题端到端问答，开启/关闭重排对比）。
- 75–90 min：总结与提交（覆盖率/一致性指标、边界与承接）。

## 开场话术（可照读）
- 今天我们将把问答的“可信度”落到可复核的引用上。目标是在中文场景里输出带引用且可定位到来源片段的答案，统一命名与错误结构，并以覆盖率与一致性进行评估。

## 核心术语与定义
- Citation：引用的样式与呈现（行内 [1]、legend 图例、链接）。
- Traceability：来源可定位（位置范围、chunk 索引、文档锚点）。
- Coverage/Consistency：引用覆盖率与一致性指标。

## 演示脚本（逐步）
1) 打开 `.env` 与项目配置，承接上一课的来源与分块策略。
2) 调用 API：
   - `POST /api/v1/retrieval/search`：确认候选来源与分数；
   - `POST /api/v1/qa/ask`：开启 `include_citations=true` 与 `citation_style`（如 `legend`）。
3) 展示响应结构：
   - `answer`：可选行内标注如“... [1]”；
   - `sources[]`：`document_id/document_filename/chunk_id/chunk_index/content/score/start_position/end_position/metadata`。
4) 一致性检查：
   - 关键句与 `sources[].content` 对齐；
   - `start_position/end_position` 或 `chunk_index` 可定位；
   - 去重与排序合理性（与重排/融合的交互）。
5) 对比：开启/关闭重排，观察引用排序与答案质量差异；记录覆盖率与一致性。
6) 现场填写提交模板：配置、日志、指标、响应片段与截图。

## 互动与提问（参考答案）
- 问：为什么要统一命名与错误结构？
  - 答：确保跨团队与自动化评审可复核，避免引用不可解析。
- 问：如何定义覆盖率？
  - 答：答案关键句中有引用标注或其在 `sources` 可定位；统计句级或 token 级覆盖。
- 问：多来源同时引用如何排序？
  - 答：优先分数高且内容更贴近关键句；可结合重排结果。

## 常见误区与应对话术
- 误区：答案包含来源但缺少定位信息。应补齐位置/索引字段。
- 误区：命名不一致导致无法过滤或评审。应严格遵循契约字段。
- 误区：过度引用导致冗长。可做摘要引用、保留核心句并提供链接。

## 总结与提交
- 总结：带引用且可溯源的答案提升可信度与可复核性，是 RAG 系统的核心能力之一。
- 提交：按模板填写 ≥3 条问题的日志与指标，附响应片段与截图；不可虚构，字段与错误结构统一。