# 代码迁移指南

## 概述

本文档说明了将违反增量开发原则的独立课程目录整合到统一项目结构中的迁移过程和新的使用方法。

## 迁移完成的模块

### 1. 分块实验模块 (lesson11 → src/chunk_experiment)

**原位置**: `lesson11_chunk_experiment/experiments/chunk_optimization/`
**新位置**: `src/chunk_experiment/`

**迁移的文件**:
- `chunk_optimizer.py` - 分块参数优化器
- `experiment_visualizer.py` - 实验结果可视化
- `interactive_tuner.py` - 交互式参数调优
- `run_chunk_experiment.py` - 实验运行脚本

**新的使用方式**:
```python
from src.chunk_experiment import ChunkOptimizer, ExperimentVisualizer
from src.chunk_experiment import InteractiveTuner

# 创建优化器
optimizer = ChunkOptimizer()
results = optimizer.optimize_parameters()

# 可视化结果
visualizer = ExperimentVisualizer()
visualizer.plot_results(results)
```

### 2. 增量更新模块 (lesson16 → src/incremental)

**原位置**: `lesson16_incremental_update/`
**新位置**: `src/incremental/`

**迁移的文件**:
- `incremental_indexer.py` → `indexer.py` - 增量索引器
- `change_detector.py` - 变更检测器
- `conflict_resolver.py` - 冲突解决器
- `version_manager.py` - 版本管理器
- `monitoring.py` - 监控管理
- `config.py` - 配置管理
- `integration.py` - 集成接口

**新的使用方式**:
```python
from src.incremental import IncrementalIndexer, ChangeDetector
from src.incremental import ConflictResolver, VersionManager

# 创建增量索引器
indexer = IncrementalIndexer()
indexer.process_changes(changes)

# 检测变更
detector = ChangeDetector()
changes = detector.detect_changes()
```

### 3. 数据连接器模块 (lesson17 → src/data_connectors)

**原位置**: `lesson17_structured_data/`
**新位置**: `src/data_connectors/`

**迁移的文件**:
- `data_connector.py` → `base.py` - 基础连接器接口
- `api_connector.py` - API连接器
- `database_connector.py` - 数据库连接器
- `sync_manager.py` - 同步管理器

**新的使用方式**:
```python
from src.data_connectors import APIConnector, DatabaseConnector
from src.data_connectors import SyncManager

# 创建API连接器
api_conn = APIConnector(config)
data = api_conn.get_data()

# 创建数据库连接器
db_conn = DatabaseConnector(config)
db_conn.sync_data()
```

## 项目新结构

```
src/
├── __init__.py                 # 统一模块入口
├── api/                        # API接口
├── chunking/                   # 分块核心功能
├── chunk_experiment/           # 分块实验和优化 (新增)
│   ├── __init__.py
│   ├── chunk_optimizer.py
│   ├── experiment_visualizer.py
│   ├── interactive_tuner.py
│   └── run_chunk_experiment.py
├── incremental/                # 增量更新功能 (新增)
│   ├── __init__.py
│   ├── indexer.py
│   ├── change_detector.py
│   ├── conflict_resolver.py
│   ├── version_manager.py
│   ├── monitoring.py
│   ├── config.py
│   └── integration.py
├── data_connectors/            # 数据连接器 (新增)
│   ├── __init__.py
│   ├── base.py
│   ├── api_connector.py
│   ├── database_connector.py
│   └── sync_manager.py
├── database/                   # 数据库操作
├── document/                   # 文档处理
├── embedding/                  # 向量嵌入
├── rag/                        # RAG核心
├── repositories/               # 数据仓库
├── rerank/                     # 重排序
├── vector_store/               # 向量存储
├── config.py                   # 全局配置
└── main.py                     # 主入口
```

## 导入路径变更

### 旧的导入方式 (已废弃)
```python
# 这些导入路径已不再有效
from lesson11_chunk_experiment.experiments.chunk_optimization import ChunkOptimizer
from lesson16_incremental_update import IncrementalIndexer
from lesson17_structured_data import DataConnector
```

### 新的导入方式
```python
# 使用新的统一导入路径
from src.chunk_experiment import ChunkOptimizer
from src.incremental import IncrementalIndexer
from src.data_connectors import DataConnector

# 或者使用统一入口
from src import chunk_experiment, incremental, data_connectors
```

## 配置文件更新

如果有配置文件引用了旧的模块路径，需要更新为新路径:

```json
{
  "modules": {
    "chunk_optimizer": "src.chunk_experiment.chunk_optimizer",
    "incremental_indexer": "src.incremental.indexer",
    "data_connector": "src.data_connectors.base"
  }
}
```

## 测试文件更新

相关的测试文件也需要更新导入路径:

```python
# 更新测试文件中的导入
from src.chunk_experiment import ChunkOptimizer
from src.incremental import IncrementalIndexer
from src.data_connectors import APIConnector
```

## 迁移收益

1. **统一项目结构**: 所有功能模块现在都在`src/`目录下，符合增量开发原则
2. **清晰的模块划分**: 每个功能模块都有明确的职责和边界
3. **简化的导入路径**: 统一的`src.`前缀，更容易记忆和使用
4. **更好的可维护性**: 代码组织更加规范，便于后续开发和维护
5. **符合最佳实践**: 遵循Python项目的标准结构和命名规范

## 注意事项

1. 所有旧的独立课程目录已被删除，请使用新的导入路径
2. 如有其他脚本或配置文件引用了旧路径，请及时更新
3. 建议在IDE中进行全局搜索替换，确保所有引用都已更新
4. 新的模块结构保持了原有的功能完整性，API接口基本不变

## 后续开发指南

- 新功能应该添加到相应的`src/`子模块中
- 遵循现有的模块结构和命名规范
- 每个新模块都应该有对应的`__init__.py`文件
- 及时更新`src/__init__.py`中的导出列表