# 第十九节课：插件化切分策略扩展 - 课程配置

## 基本信息

| 项目 | 内容 |
|------|------|
| 课程编号 | Lesson 19 |
| 课程名称 | 插件化切分策略扩展 |
| 课程类型 | 实践课 |
| 课程时长 | 45分钟 |
| 难度等级 | 中级 |
| 前置课程 | Lesson 1-18 |

## 教学目标

### 知识目标
- 理解插件化架构的设计原理
- 掌握策略模式在RAG系统中的应用
- 了解插件注册和发现机制
- 学习插件生命周期管理

### 技能目标
- 能够创建自定义切分策略插件
- 掌握插件注册和使用方法
- 能够为插件添加配置和监控功能
- 具备扩展现有插件系统的能力

## 技术栈要求

### 核心技术
- Python 3.12+
- 抽象基类 (ABC)
- 策略模式
- 单例模式
- 正则表达式

### 依赖库
```python
# 核心依赖
from abc import ABC, abstractmethod
from typing import List, Dict, Any, Optional, Union, Tuple
from dataclasses import dataclass
import time
import logging
import re
import threading
import inspect
from functools import wraps

# 性能监控
import psutil  # 内存监控
```

### 项目结构
```
rag-system/
├── src/
│   └── chunking/
│       ├── __init__.py                    # 模块初始化和策略注册
│       ├── strategy_interface.py          # 策略接口定义
│       ├── plugin_registry.py             # 插件注册系统
│       ├── chunker.py                     # 基础切分器
│       ├── semantic_chunker.py            # 语义切分策略
│       ├── sentence_chunker.py            # 句子切分策略
│       ├── structure_chunker.py           # 结构切分策略
│       └── smart_paragraph_chunker.py     # 智能段落切分策略（新增）
└── lesson19/
    ├── 第十九节课_插件化切分策略扩展_教师讲义.md
    ├── 第十九节课_插件化切分策略扩展_学生实验指导.md
    ├── 课程配置.md
    └── test_smart_paragraph.py            # 测试脚本
```

## 实验环境

### Git分支管理
```bash
# 创建lesson19分支
git checkout -b lesson19

# 基于现有代码进行增量开发
# 不创建独立项目，在统一项目中添加功能
```

### 开发环境要求
- Python 3.12+
- Git 版本控制
- 代码编辑器（VS Code推荐）
- 终端/命令行工具

### 运行环境
```bash
# 确保在项目根目录
cd /path/to/rag-system

# 激活虚拟环境（如果使用）
source .venv/bin/activate  # Linux/Mac
# 或
.venv\Scripts\activate     # Windows

# 安装依赖（如果需要）
pip install psutil
```

## 课程内容结构

### 理论部分（15分钟）
1. **插件化架构概述** (5分钟)
   - 插件化架构的优势
   - 在RAG系统中的应用
   - 与传统架构的对比

2. **策略模式深入** (5分钟)
   - 策略模式的实现
   - 接口设计原则
   - 策略注册机制

3. **现有系统分析** (5分钟)
   - 现有插件系统架构
   - 已实现的策略类型
   - 扩展点识别

### 实践部分（25分钟）
1. **创建智能段落策略** (10分钟)
   - 实现策略类
   - 段落识别算法
   - 智能合并逻辑

2. **插件注册和测试** (8分钟)
   - 注册新策略
   - 编写测试代码
   - 验证功能正确性

3. **性能监控和优化** (7分钟)
   - 添加性能指标
   - 对比不同策略
   - 参数调优

### 总结部分（5分钟）
1. **成果展示** (2分钟)
2. **问题讨论** (2分钟)
3. **课后作业布置** (1分钟)

## 评估标准

### 实验完成度（60%）
- [ ] 成功创建 `SmartParagraphStrategy` 类 (20%)
- [ ] 正确实现所有必需方法 (20%)
- [ ] 成功注册和测试策略 (20%)

### 代码质量（25%）
- [ ] 代码结构清晰，符合规范 (10%)
- [ ] 错误处理完善 (8%)
- [ ] 注释和文档完整 (7%)

### 理解程度（15%）
- [ ] 能够解释插件化架构原理 (8%)
- [ ] 理解策略模式的应用 (7%)

## 常见问题和解决方案

### 技术问题

**Q1: 策略类继承错误**
```python
# 错误示例
class MyStrategy:  # 缺少继承
    pass

# 正确示例
class MyStrategy(ChunkingStrategy):  # 正确继承
    pass
```

**Q2: 抽象方法未实现**
```python
# 必须实现的方法
def get_strategy_name(self) -> str:
    return "my_strategy"

def get_strategy_description(self) -> str:
    return "我的自定义策略"

def chunk_text(self, text: str, source_file: str = "") -> List[DocumentChunk]:
    # 实现切分逻辑
    pass
```

**Q3: 导入路径问题**
```python
# 确保正确的导入路径
sys.path.append(os.path.join(os.path.dirname(__file__), '..'))
from src.chunking import StrategyRegistry
```

### 环境问题

**Q1: 模块找不到**
- 检查 `PYTHONPATH` 设置
- 确认 `__init__.py` 文件存在
- 验证文件路径正确性

**Q2: 依赖库缺失**
```bash
# 安装必要依赖
pip install psutil
```

## 扩展学习

### 进阶主题
1. **动态插件加载**
   - 从配置文件加载插件
   - 运行时热插拔
   - 插件版本管理

2. **插件安全性**
   - 插件沙箱机制
   - 权限控制
   - 恶意插件防护

3. **性能优化**
   - 插件缓存策略
   - 并发执行优化
   - 内存使用优化

### 相关资源
- [设计模式：策略模式](https://refactoring.guru/design-patterns/strategy)
- [Python ABC模块文档](https://docs.python.org/3/library/abc.html)
- [插件架构设计最佳实践](https://martinfowler.com/articles/plugins.html)

## 课后作业

### 基础作业
1. 完善 `SmartParagraphStrategy` 的实现
2. 添加更多配置参数
3. 编写单元测试

### 进阶作业
1. 创建基于关键词的切分策略
2. 实现策略组合机制
3. 添加策略性能基准测试

### 挑战作业
1. 设计插件配置文件格式
2. 实现插件的动态加载和卸载
3. 创建插件管理的Web界面

## 下节课预告

**第二十节课：RAG系统缓存优化策略**
- 查询缓存设计
- 向量缓存机制
- 结果缓存优化
- 缓存一致性保证
- 分布式缓存架构