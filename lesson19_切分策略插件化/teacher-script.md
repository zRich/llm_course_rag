# Lesson 19 教师讲稿：切分策略插件化

本讲稿提供 45 分钟可照读脚本，覆盖术语、架构、端到端演示与互动问答，强调接口一致性与可观测指标。

## 时间轴（45 分钟）
- 0:00–3:00 开场与学习目标（SMART）
- 3:00–10:00 核心术语与契约
- 10:00–20:00 架构与实现（策略接口/注册器/管理器/度量）
- 20:00–35:00 端到端演示（多策略对比与指标）
- 35:00–41:00 故障注入（策略缺失/参数越界/语种不匹配）
- 41:00–45:00 提问互动与总结、提交要求强调

## 开场话术（示例）
今天我们聚焦“切分策略插件化”。目标是用统一的接口与注册机制，让不同文本域的切分策略可插拔、可对比、可度量。课后你能定义并注册新策略，输出统一文档片段与指标报告，并以错误路径兜底维持一致性。

## 核心术语与定义
- 切分策略（Chunk Strategy）：将原始文本切分为片段的算法实现。
- 策略接口（Strategy Interface）：约定 `chunk(text) -> List[Chunk]` 与 `get_info()` 等方法。
- 策略注册器（Strategy Registry）：以 `name -> class` 注册与工厂创建实例。
- 语义边界（Semantic Boundary）：基于句法/语义信号确定片段边界。
- 重叠（Overlap）：片段间的上下文重叠字符或 token 数，以提升召回。
- 指标面板：平均片长、重叠率、边界对齐率、token 分布、错误率。

## 架构与实现要点
- 抽象接口：输入为 `text` 与可选 `config`；输出为结构化 `chunks`，包含 `chunk_id/offset/length/text/metadata`。
- 注册与发现：统一入口创建策略；支持版本与优先级；错误时给出可解释提示。
- 策略示例：固定长度、段落边界、语义切分（句号/问号/语言模型权重）。
- 组合与对比：支持链式切分与策略对比实验，输出统一指标。
- 可观测性：记录策略命中率、误分割率、平均耗时；产出对比表与日志片段。

## 端到端演示步骤与话术
1) 打开 `examples/raw_text.txt` 与 `examples/plugin_config.json`，说明策略与参数。
2) 运行固定长度策略：观察平均片长、重叠率与边界误差。
3) 切换段落边界策略：展示标点/空行命中情况。
4) 语义策略：在包含中英文与代码片段的文本上对比边界对齐率。
5) 输出统一格式 `chunks` 与指标摘要；强调命名与字段一致性。

## 故障注入与兜底
- 策略缺失：请求未注册名称，注册器返回标准错误结构与替代策略。
- 参数越界：`max_chunk_size` 太小或太大，提示并回退到安全阈值。
- 语种不匹配：语义策略在非目标语言文本上降级为规则策略。

## 课堂提问与互动
- 重叠的最优取值如何基于检索性能确定？
- 语义边界 vs 段落边界的权衡与混合策略？
- 如何将策略指标与下游召回/精度建立映射？

## 总结话术
插件化切分的关键是统一接口、可插拔实现与度量驱动的选择。正确的工程化方法是“先定义契约与指标，再实现策略并对比复盘”。

## 提交要求与验收复盘（与 checklist 对齐）
- 文档齐备：README、teacher-script、blackboard-steps、checklist、examples、templates。
- 接口一致：字段命名与错误结构统一。
- 指标达成：给出至少两种策略对比与指标表。
- 报告与证据：运行日志片段、截图与配置说明。