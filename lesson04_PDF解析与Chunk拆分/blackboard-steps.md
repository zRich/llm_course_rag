# Lesson 04 板书步骤与教学流程

## 板书布局设计

```
┌─────────────────────────────────────────────────────────────────┐
│                    Lesson 04: PDF解析与Chunk拆分                │
├─────────────────────────────────────────────────────────────────┤
│ 目标产物                    │ 核心技术                          │
│ • PDF解析模块               │ • PyMuPDF (fitz)                │
│ • Chunk拆分算法             │ • 语义边界识别                    │
│ • 文档处理流水线            │ • 重叠策略设计                    │
├─────────────────────────────────────────────────────────────────┤
│                        今日学习路径                              │
│ PDF结构 → PyMuPDF API → Chunk策略 → 实现演示 → Exercise        │
└─────────────────────────────────────────────────────────────────┘
```

---

## 教学步骤详解

### Step 1: 课程导入与目标设定（10分钟）

#### 板书内容
```
【今日目标】
✓ 掌握PDF文档解析技术
✓ 实现智能Chunk拆分算法  
✓ 构建文档处理流水线
✓ 提交物：解析模块 + 拆分算法

【为什么重要？】
前置：环境搭建 → 服务启动 → 数据模型
当前：文档解析 ← 你在这里
后续：向量化 → 检索 → 生成
```

#### 教学动作
- [ ] 在黑板左上角写下课程标题
- [ ] 列出今日的具体学习目标
- [ ] 画出学习路径图，标明当前位置
- [ ] 强调本课在整个RAG系统中的关键作用

### Step 2: PDF文档结构解析（10分钟）

#### 板书内容
```
【PDF文档结构】
┌─ 文档级别 ─┐
│ • 元数据   │ ← 标题、作者、创建时间
│ • 页面集合 │ ← 多个页面对象
└───────────┘
     ↓
┌─ 页面级别 ─┐
│ • 页面属性 │ ← 尺寸、旋转、媒体框
│ • 内容流   │ ← 文本、图像、图形指令
└───────────┘
     ↓
┌─ 内容级别 ─┐
│ • 文本对象 │ ← 字符、字体、位置
│ • 图像对象 │ ← 图片数据和位置  
│ • 图形对象 │ ← 线条、形状、颜色
└───────────┘
```

#### 教学动作
- [ ] 画出PDF文档的层次结构图
- [ ] 用不同颜色标记各个层级
- [ ] 举例说明每个层级包含的信息
- [ ] 解释为什么需要专业解析库

### Step 3: PyMuPDF核心API讲解（10分钟）

#### 板书内容
```
【PyMuPDF核心API】
import fitz  # PyMuPDF的Python接口

基础流程：
1. doc = fitz.open("file.pdf")     ← 打开文档
2. page = doc[page_num]            ← 获取页面
3. text = page.get_text()          ← 提取文本
4. blocks = page.get_text("dict")  ← 结构化提取
5. images = page.get_images()      ← 提取图片
6. doc.close()                     ← 关闭文档

【关键参数】
• get_text()        → 纯文本
• get_text("dict")  → 含位置信息
• get_text("blocks") → 按块提取
```

#### 教学动作
- [ ] 在黑板中央写出API调用流程
- [ ] 用箭头标明数据流向
- [ ] 用不同颜色区分输入输出
- [ ] 标注每个方法的返回值类型

### Step 4: Chunk拆分策略设计（10分钟）

#### 板书内容
```
【Chunk拆分策略对比】
┌─────────────┬─────────────┬─────────────┬─────────────┐
│   策略类型   │    优点     │    缺点     │  适用场景   │
├─────────────┼─────────────┼─────────────┼─────────────┤
│ 固定长度拆分 │ 简单快速    │ 破坏语义    │ 简单文档    │
│ 语义边界拆分 │ 保持完整    │ 长度不均    │ 高质量要求  │
│ 滑动窗口拆分 │ 覆盖全面    │ 存储空间大  │ 检索精度高  │
└─────────────┴─────────────┴─────────────┴─────────────┘

【重叠策略】
Chunk1: [────────────]
Chunk2:      [────────────]  ← 10-20%重叠
Chunk3:           [────────────]

边界优先级：段落 > 句子 > 子句 > 词汇
```

#### 教学动作
- [ ] 画出策略对比表格
- [ ] 用图示展示重叠策略
- [ ] 标明边界识别的优先级
- [ ] 举例说明不同策略的效果差异

### Step 5: 代码演示与实现（35分钟）

#### 板书内容
```
【演示1：基础PDF解析】
demo_pdf_parsing():
  ├─ 打开文档 → 获取元数据
  ├─ 遍历页面 → 提取文本
  ├─ 结构化提取 → 分析文本块
  └─ 异常处理 → 资源清理

【演示2：智能Chunk拆分】
SmartChunker类设计：
  ├─ __init__() → 参数配置
  ├─ split_text() → 主拆分逻辑
  ├─ _find_optimal_split_point() → 边界识别
  └─ 重叠处理 → 连续性保证

【关键算法】
边界模式（优先级递减）：
1. \n\n+          ← 段落边界
2. [。！？]\s*\n   ← 句子边界  
3. [。！？]\s+     ← 句内边界
4. [，；]\s+       ← 子句边界
5. \s+            ← 词汇边界
```

#### 教学动作
- [ ] 在黑板右侧列出演示大纲
- [ ] 实时更新代码执行结果
- [ ] 用不同颜色标记关键代码段
- [ ] 画出算法流程图

### Step 6: Exercise练习指导（10分钟）

#### 板书内容
```
【Exercise任务】
目标：解析PDF + Chunk拆分

步骤：
1. 使用PyMuPDF打开 examples/exercise_document.pdf
2. 提取所有页面文本内容
3. 应用SmartChunker进行拆分
4. 输出统计信息

【预期输出】
=== PDF解析结果 ===
文档页数: 5
总文本长度: 12,450字符

=== Chunk拆分结果 ===  
总Chunk数: 18
平均长度: 692字符
最大长度: 998字符
最小长度: 234字符

【评分标准】
✓ PDF成功解析 (30分)
✓ 文本正确提取 (30分)  
✓ Chunk合理拆分 (30分)
✓ 统计信息准确 (10分)
```

#### 教学动作
- [ ] 在黑板下方写出Exercise要求
- [ ] 标明每个步骤的关键点
- [ ] 展示预期输出格式
- [ ] 说明评分标准和时间限制

### Step 7: 总结与答疑（5分钟）

#### 板书内容
```
【今日收获总结】
✓ PyMuPDF API掌握 → 文档解析能力
✓ Chunk拆分策略 → 语义处理技能
✓ 智能边界识别 → 算法设计思维
✓ 完整处理流水线 → 工程实践经验

【下节课预告】
Lesson 05: Embedding与向量入库
├─ 文本向量化原理
├─ bge-m3模型使用  
├─ Qdrant向量数据库
└─ 向量存储与检索

【课后任务】
1. 完善Chunk拆分算法
2. 处理复杂文档结构
3. 优化性能和内存使用
4. 准备个人PDF文档用于下节课
```

#### 教学动作
- [ ] 总结今日关键知识点
- [ ] 预告下节课内容
- [ ] 布置课后任务
- [ ] 开放提问时间

---

## 板书时间分配

| 教学环节 | 板书时间 | 主要内容 | 板书重点 |
|---------|---------|---------|---------|
| 课程导入 | 2分钟 | 目标设定、路径图 | 清晰的学习目标 |
| PDF结构 | 3分钟 | 层次结构图 | 可视化结构关系 |
| API讲解 | 3分钟 | 核心API流程 | 代码调用顺序 |
| 策略设计 | 4分钟 | 对比表格、重叠图 | 策略优缺点对比 |
| 代码演示 | 15分钟 | 实时代码、结果展示 | 关键算法逻辑 |
| Exercise | 3分钟 | 任务要求、评分标准 | 明确的操作步骤 |
| 总结答疑 | 2分钟 | 知识点总结 | 承上启下的连接 |

---

## 板书材料准备

### 必需物品
- [ ] 彩色粉笔/马克笔（至少3种颜色）
- [ ] 黑板擦
- [ ] 直尺（画表格和流程图用）
- [ ] 示例PDF文档
- [ ] 笔记本电脑（代码演示）
- [ ] 投影设备（代码展示）

### 备用方案
- [ ] 白板和白板笔（如果没有黑板）
- [ ] 打印版的关键图表（备用展示）
- [ ] U盘（代码备份）
- [ ] 网络热点（网络故障备用）

---

## 互动环节设计

### 提问时机
1. **PDF结构讲解后**："大家平时处理PDF时遇到过什么问题？"
2. **API演示中**："这个方法的返回值是什么类型？"
3. **策略对比时**："你们觉得哪种策略更适合技术文档？"
4. **Exercise前**："有没有不清楚的地方需要再解释？"

### 学生参与
- 邀请学生到黑板前画出PDF结构图
- 让学生预测不同参数设置的效果
- 鼓励学生分享Exercise中遇到的问题
- 组织小组讨论最优的拆分策略

### 课堂氛围
- 保持轻松但专注的学习氛围
- 及时表扬学生的正确回答
- 耐心解答所有技术问题
- 鼓励学生之间的讨论交流